<!DOCTYPE html>
<html class="x-admin-sm">

    <head>
        <meta charset="UTF-8">
        <title>å‘è´§è®°å½•</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<!--        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">
        <script src="./lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="./js/xadmin.js"></script>
        <script type="text/javascript" src="./js/jquery.min.js"></script>
        <script src="data/dataServer.js"></script>
        <!--[if lt IE 9]>
          <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
          <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>
        <div class="x-nav">
            <span class="layui-breadcrumb">
                <a href="">é¦–é¡µ</a>
                <a href="">å‘è´§è®°å½•</a>
                <a>
                    <cite>å‘è´§è®°å½•</cite></a>
            </span>
            <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="åˆ·æ–°">
                <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
            </a>
        </div>
        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
<!--                        <div class="layui-card-body ">-->
<!--                            <form class="layui-form layui-col-space5">-->
<!--                                <div class="layui-inline layui-show-xs-block">-->
<!--                                    <input class="layui-input" autocomplete="off" placeholder="å¼€å§‹æ—¥" name="start" id="start"></div>-->
<!--                                <div class="layui-inline layui-show-xs-block">-->
<!--                                    <input class="layui-input" autocomplete="off" placeholder="æˆªæ­¢æ—¥" name="end" id="end"></div>-->
<!--                                <div class="layui-inline layui-show-xs-block">-->
<!--                                    <input type="text" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autocomplete="off" class="layui-input"></div>-->
<!--                                <div class="layui-inline layui-show-xs-block">-->
<!--                                    <button class="layui-btn" lay-submit="" lay-filter="sreach">-->
<!--                                        <i class="layui-icon">&#xe615;</i></button>-->
<!--                                </div>-->
<!--                            </form>-->
<!--                        </div>-->
                        <div class="layui-card-body ">
<!--                            <table class="layui-table" lay-data="{url:'./user.json',page:true,toolbar: '#toolbarDemo',id:'test'}" lay-filter="test">-->
<!--                                <thead>-->
<!--                                    <tr>-->
<!--                                        <th lay-data="{type:'checkbox'}">ID</th>-->
<!--                                        <th lay-data="{field:'pid', width:80, sort: true}">ID</th>-->
<!--                                        <th lay-data="{field:'deviceId', width:120, sort: true, edit: 'text'}">è®¾å¤‡æ ‡è¯†</th>-->
<!--                                        <th lay-data="{field:'deviceIp', edit: 'text', minWidth: 150}">è®¾å¤‡IP</th>-->
<!--                                        <th lay-data="{field:'deviceLocation', width:80,templet: '#switchTpl'}">ä½ç½®ä¿¡æ¯</th>-->
<!--                                        <th lay-data="{field:'city', edit: 'text', minWidth: 100}">åŸå¸‚</th>-->
<!--                                        <th lay-data="{field:'experience', sort: true, edit: 'text'}">ç§¯åˆ†</th>-->
<!--                                        <th lay-data="{field:'dw_xinzhi',templet: function(d){ return d.dw_xinzhi.titel;}}">å­¦æ ¡</th></tr>-->
<!--                                </thead>-->
<!--                            </table>-->
                            åœ°ç‚¹: <select id="select_address" style="width: 100px;height: 20px">
                                    <option value="0">è¯·é€‰æ‹©</option>
                            </select>
                            <div class="layui-inline layui-show-xs-block">
                                <button class="layui-btn" lay-submit="" lay-filter="sreach" onclick="searchInfo()">
                                    <i class="layui-icon">&#xe615;</i></button>
                            </div>
<!--                            <a  onclick="showDetailsByMin()" style="color: #00a0e9; text-decoration:underline;"> æŸ¥çœ‹è¯¦ç»†</a>-->
                            <table id="demo" class="layui-table" lay-filter="test_table" ></table>
                            <div id="test1"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="box1" style="width:600px;height:400px;display: none">
            <div id="showUploadFile">
                <input type="file" id="file_1" accept="image/jpg, image/png, image/jpeg, image/gif" >
                <button type="button" class="layui-btn" id="saveFile" onclick="saveFileInfo()"><i class="layui-icon">î™¼</i>ä¸Šä¼ </button>
            </div>
            <div id="showFileListInfo"></div>
        </div>
    </body>
    <script type="text/html" id="toolbarMenu">
        <div class = "layui-btn-container"  id="tableMenu">
            <!--            <button class = "layui-btn layui-btn-sm" lay-event = "getCheckData" > è·å–é€‰ä¸­è¡Œæ•°æ® </button>-->
            <!--            <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">è·å–é€‰ä¸­æ•°ç›®</button >-->
            <button class = "layui-btn layui-btn-sm" lay-event = "addSensor" onclick="xadmin.open('æ·»åŠ è®°å½•','./ai_deliverRecord_AddOrEdit.html?id=-1',600,400)" ><i class="layui-icon">î˜ˆ</i> æ·»åŠ è®°å½•</button>
            <!--            <button class = "layui-btn layui-btn-danger" lay-event = "delCheckData" > <i class="layui-icon">î™€</i>åˆ é™¤é€‰ä¸­ </button>-->
<!--            <button type="button" class="layui-btn" id="test3"><i class="layui-icon">î™¼</i>ä¸Šä¼ æ–‡ä»¶</button>-->

        </div >
    </script>
    <script type="text/html" id="toolbarDemo">
        <div class = "layui-btn-container" >
            <button class = "layui-btn layui-btn-sm" lay-event = "getCheckData" > è·å–é€‰ä¸­è¡Œæ•°æ® </button>
            <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">è·å–é€‰ä¸­æ•°ç›®</button >
<!--            <button class = "layui-btn layui-btn-sm" lay-event = "isAll" > éªŒè¯æ˜¯å¦å…¨é€‰</button>-->
<!--            <button class = "layui-btn layui-btn-danger"   lay-event = "delete" > åˆ é™¤</button>-->
<!--            {{# if(d.attachmentList.length>0){ }}-->
<!--                 <button class = "layui-btn layui-btn-sm"   lay-event = "updateWarningInfo" > ç¡®å®š</button>-->
<!--            {{# } }}-->

            {{# if(d.status==""){}}
                <i class="layui-icon layui-icon-edit"    lay-event = "edit" >&nbsp;&nbsp;</i>
                <i class="layui-icon layui-icon-delete"  lay-event = "delete" >&nbsp;&nbsp;</i>
                <i class="layui-icon layui-icon-upload"  lay-event = "uploadFile" >&nbsp;&nbsp;</i>
                <button  class="layui-btn  layui-btn-normal" lay-event = "lockData" >ğŸ”’</button>
            {{# } else{}}
                 <i class="layui-icon"  lay-event = "" onclick="layer.msg('å·²é”å®šï¼')">ğŸ”’</i>
            {{# } }}

<!--            {{# if(d.attachmentList.length>0){ }}-->
<!--                <i class="layui-icon layui-icon-carousel"  lay-event = "showPic" >&nbsp;&nbsp;</i>-->
<!--            {{# } }}-->
<!--            <button type="button" class="layui-btn"><i class="layui-icon">î™¼</i></button>-->
<!--            <img src="images/att.png" style="width: 15px; height: 15px;" lay-enent="uploadFile">-->
        </div >
    </script>

    <script type="text/javascript">

        // setInterval(function(){
        //    // initData();
        // },1000);
        function showDetailsByMin(){
            xadmin.open('è¯¦ç»†ä¿¡æ¯','warningList.html');
        }

        $(function () {
             initSelectData();
             searchInfo();
        });

        function searchInfo(){
            initData();
        }
        function  initSelectData() {
            // var dataSensor=sensorServer.getMinesList({"page":1,"rows":1000});
            // if (dataSensor!=null) {
            //     let optionList="";
            //     for(let i=0;i<dataSensor.data.length;i++){
            //         optionList+="<option value='"+dataSensor.data[i].id+"'>"+dataSensor.data[i].mineName+"</option>";
            //     }
            //     $("#select_address").append(optionList);
            // }
        }
        //è¯·æ±‚æ•°æ®
        function getData(page,limit) {
            var resultData;
            let minesId=$("#select_address").val();
            var params={"page":page,"rows":limit,"minesId":minesId}
            resultData = dataServer.getUserList(params);
            return resultData;
        }

        function saveFileInfo() {
            let formData = new FormData();
            if(document.getElementById('file_1').files.length==0)
            {
                alert("è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼ï¼");
                return;
            }
            formData.append("file", document.getElementById('file_1').files[0]);
            let url=sensorServer.getUploadFileUrl();
            $.ajax({
                url:url,
                type:"post",
                data:formData,
                processData:false,
                contentType:false,
                success:function(data){
                    console.log(JSON.stringify(data));
                    debugger;
                    if(data.msg=="æ“ä½œæˆåŠŸ"&&data.data!=null){
                        let uploadSuccessPath=data.data;
                        if(uploadSuccessPath!="") {
                            let fileName=document.getElementById('file_1').files[0].name;
                            let serverUrl=data.data;
                            let params={"fileUrl":serverUrl,"fileName":fileName,"deliverRecordId":uploadDeliverRecordId};
                            let result=sensorServer.saveDeliverRecordAttachment(params);
                            if(result==1)
                               layer.msg("ä¸Šä¼ æˆåŠŸï¼");
                            else
                               layer.msg("æ“ä½œå¤±è´¥ï¼");
                        }else{
                            layer.msg("ä¿å­˜å¤±è´¥ï¼");
                        }
                    }else{
                        alert(JSON.stringify(data));
                        layer.msg("ä¸Šä¼ å¤±è´¥ï¼");
                    }
                },
                error:function(e){
                    alert("é”™è¯¯ï¼ï¼");

                }
            });
        }
        let uploadDeliverRecordId=0;
        function refData(dataList){
            debugger;
            //var dataList=dataArraygetData(page,limit).data;
            layui.use('table', function () {
                var table = layui.table;
                //ç¬¬ä¸€ä¸ªå®ä¾‹
                table.render({
                    elem: '#demo'
                    ,toolbar: "#toolbarMenu"
                    ,height: 450
                    ,data: dataList
                    ,limit:dataList.length
                    //page:false
                    ,cols: [[ //è¡¨å¤´
                        {field: 'Id', title: 'ç¼–å·', width: 80, sort: true, fixed: 'left'}
                        , {field: 'username', title: 'ç”¨æˆ·å', width: 80,edit: 'text'}
                        , {field: 'gender', title: 'æ€§åˆ«', width: 80, edit: 'text'}
                        , {field: 'password', title: 'å¯†ç ', width: 80, edit: 'text'}
                        , {field: 'address', title: 'åœ°å€', width: 80, edit: 'text'}
                        , {field: 'email', title: 'é‚®ç®±', width: 80, edit: 'text'}
                        , {field: 'phone', title: 'ç”µè¯', width: 80, edit: 'text'}
                        , {field: '', title: 'ç¼–è¾‘', width: 250, sort: true, toolbar:'#toolbarDemo'}
                    ]],
                    loading:true,
                    done:function (res, curr, count) {
                        // $("[data-field='status']").children().each(function(){
                        //     if($(this).text()==0){
                        //         $(this).text("") ;//ğŸ”
                        //         //debugger;
                        //     }else if($(this).text()==1){
                        //         debugger;
                        //         $(this).text("ğŸ”’")  ;//ğŸ”’
                        //     }
                        // });
                        // $("[data-field='attachmentList']").children().each(function(e){
                        //     if($(this).text()=="[object Object]"){
                        //         $(this).text("æŸ¥çœ‹é™„ä»¶");
                        //     }
                        // });
                    },
                    parseData:function(res){
                        return {
                            "code" : res.code, //è§£ææ¥å£çŠ¶æ€
                            "msg" : res.msg, //è§£ææç¤ºæ–‡æœ¬
                            "data" : res.data //è§£ææ•°æ®åˆ—è¡¨
                        }
                    }
                });

                //ç›‘å¬å•å…ƒæ ¼ç¼–è¾‘
                // table.on('edit(test_table)',
                //     function (obj) {
                //         var value = obj.value //å¾—åˆ°ä¿®æ”¹åçš„å€¼
                //             ,
                //             data = obj.data //å¾—åˆ°æ‰€åœ¨è¡Œæ‰€æœ‰é”®å€¼
                //             ,
                //             field = obj.field; //å¾—åˆ°å­—æ®µ
                //         layer.msg('[ID: ' + data.id + '] ' + field + ' å­—æ®µæ›´æ”¹ä¸ºï¼š' + value);
                //         //updateTable(data.pid,value);
                //         var jsonResult = sensorServer.updateSensorInfo(obj.data);
                //         console.log(jsonResult);
                //     });

                //ç›‘å¬è¡Œå•å‡»äº‹ä»¶ï¼ˆåŒå‡»äº‹ä»¶ä¸ºï¼šrowDoubleï¼‰
                // table.on('row(test_table)', function(obj){
                //     var data = obj.data;
                //     layer.alert(JSON.stringify(data), {
                //         title: 'å½“å‰è¡Œæ•°æ®ï¼š'
                //     });
                //
                //     //æ ‡æ³¨é€‰ä¸­æ ·å¼
                //     obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
                // });

                //åˆ—é‡Œçš„å·¥å…·æ 
                table.on('tool(test_table)',
                    function(obj) {
                        //var checkStatus = table.checkStatus(obj.config.pid);
                        switch (obj.event) {
                            case 'delete':
                                layer.msg('data:'+obj.data.id);
                                del(obj);
                                break;
                            case 'edit':
                                layer.msg('data:'+obj.data.id);
                                xadmin.open('ä¿®æ”¹è®°å½•','./ai_deliverRecord_AddOrEdit.html'+"?id="+obj.data.id,600,400);
                                break;
                                //updateWarningInfo(obj);
                                //break;
                            case 'uploadFile':
                                layer.msg('data:'+obj.data.id);
                                uploadDeliverRecordId=obj.data.id;
                                $("#showFileListInfo").html("");
                                $("#showUploadFile").show();
                                //showUploadFile();
                                break;
                            case 'showPic':
                                    //console.log(obj.data.id);
                                    //showUploadFile();
                                    //$("#showFileListInfo").html("");
                                    //$("#showUploadFile").hide();
                                    //let html="";
                                    //debugger;
                                    // if(obj.data.attachmentList.length>0){
                                    //     for (let  i=0;i<obj.data.attachmentList.length;i++){
                                    //         html+="<img style='width: 150px; height: 100px;' src='"+obj.data.attachmentList[i].url+"' />";
                                    //     }
                                    // }
                                    // $("#showFileListInfo").html(html);
                                    break;
                             case 'lockData':
                                 // let msg="ç¡®å®šè¦é”å®šå—ï¼Ÿé”å®šåä¸å¯è¿›è¡Œä»»ä½•æ›´æ”¹ï¼";
                                 // layer.confirm(msg,function(index) {
                                 //     obj.data.status=1;
                                 //     let result=sensorServer.updateDeliverRecord(obj.data);
                                 //     if(result==1){
                                 //         layer.msg('å·²é”å®š!',{icon:1,time:1000});
                                 //         location.reload();
                                 //     }else{
                                 //         layer.msg('é”å®šå¤±è´¥!',{icon:2,time:1000});
                                 //     }
                                 // });
                                 break;
                        };
                    });
            });
        }

        function initData(){
            var initData=getData(1,10);
            var total=initData.total;
            var dataList=initData.data;
            layui.use('table', function(){
                var laypage = layui.laypage;
                //æ‰§è¡Œä¸€ä¸ªlaypageå®ä¾‹
                laypage.render({
                    elem: 'test1' //æ³¨æ„ï¼Œè¿™é‡Œçš„ test1 æ˜¯ IDï¼Œä¸ç”¨åŠ  # å·
                    ,count: total //æ•°æ®æ€»æ•°ï¼Œä»æœåŠ¡ç«¯å¾—åˆ°
                    //,limit:10
                    ,limits:[10,20,30]
                    ,curr:1
                    ,group:5
                    ,layout: ['prev', 'page', 'next','limit','refresh','skip','count']
                    ,jump: function(obj, first){
                        //objåŒ…å«äº†å½“å‰åˆ†é¡µçš„æ‰€æœ‰å‚æ•°ï¼Œæ¯”å¦‚ï¼š
                        console.log(obj.curr); //å¾—åˆ°å½“å‰é¡µï¼Œä»¥ä¾¿å‘æœåŠ¡ç«¯è¯·æ±‚å¯¹åº”é¡µçš„æ•°æ®ã€‚
                        console.log(obj.limit); //å¾—åˆ°æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°
                        //é¦–æ¬¡ä¸æ‰§è¡Œ
                        if(!first){
                            refData(getData(obj.curr,obj.limit).data);
                        }else{
                            refData(dataList);
                        }

                    }
                });
            });
        }


        //åˆ é™¤
        function del(obj) {
            //var params={"pids":[obj.data.pid]}
            let msg="ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ";
            layer.confirm(msg,function(index) {
                var params = obj.data;
                var resultData = sensorServer.delDeliverRecord(params);
                if (resultData == 1) {
                    location.reload();
                }
            });
        }

        function  updateWarningInfo(obj){
            obj.data.active=0;
            msg="ç¡®è®¤å·²é˜…è¯»æ­¤è­¦ç¤ºï¼Œå¹¶è¿›è¡Œç›¸å…³å¤„ç†å—ï¼Ÿ";
            layer.confirm(msg,function(index){
                var jsonResult = sensorServer.updateWarningInfo(obj.data);
                layer.msg('å·²è®¾ç½®!',{icon:1,time:1000});
                location.reload();
            });
        }

        function showUploadFile(){
            layer.open({
                type: 1,
                closeBtn: 1,
                shift: 2,
                area:['600px','400px'],
                shadeClose: true,
                content: $("#box1")
            });
        }
    </script>


</html>
