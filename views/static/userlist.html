<!DOCTYPE html>
<html class="x-admin-sm">
<head>
    <meta charset="UTF-8">
    <title>GoAdmin</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <link rel="stylesheet" href="css/font.css">
    <link rel="stylesheet" href="css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <script type="text/javascript" src="./js/cookie.js"></script>
    <script src="data/dataServer.js"></script>

    <!-- è®©IE8/9æ”¯æŒåª’ä½“æŸ¥è¯¢ï¼Œä»è€Œå…¼å®¹æ …æ ¼ -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
        .layui-table-cell {
            text-align: center;
            height: auto;
            white-space: normal;
        }

        .layui-table img {
            max-width: 80px;
        }
    </style>
</head>

<body class="">
<div class="x-nav">
            <span class="layui-breadcrumb">
                <a href="">é¦–é¡µ</a>
                <a href="">æ•°æ®ç®¡ç†</a>
                <a>
                    <cite>ç”¨æˆ·ä¿¡æ¯ç®¡ç†</cite></a>
            </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
       onclick="location.reload()" title="åˆ·æ–°">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
    </a>
</div>
<div class="x-body">
    <div class="layui-row">
        <form class="layui-form layui-col-md12 x-so">
        </form>
    </div>
    <div class="layui-fluid">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-body ">
                        <table id="demo" class="layui-table" lay-filter="test_table"></table>
                        <div id="test1"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="toolbarMenu">
    <div class="layui-btn-container">
        <!--            <button class = "layui-btn layui-btn-sm" lay-event = "getCheckData" > è·å–é€‰ä¸­è¡Œæ•°æ® </button>-->
        <!--            <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">è·å–é€‰ä¸­æ•°ç›®</button >-->
        <button class="layui-btn layui-btn-sm" lay-event="addSensor"
                onclick="xadmin.open('æ–°å¢ç”¨æˆ·','./userlist-add.html',900,450)"> æ–°å¢ç”¨æˆ·
        </button>
        <button class="layui-btn layui-btn-danger" lay-event="delCheckData"><i class="layui-icon">î™€</i>åˆ é™¤é€‰ä¸­</button>
    </div>
</script>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-danger" lay-event="delete"> åˆ é™¤</button>
        <button class="layui-btn layui-btn-sm" lay-event="update">ä¿®æ”¹</button>
        <!--        {{# if(d.status!=2){ }}-->
        <!--        <button class = "layui-btn layui-btn-sm"   lay-event = "updateWarningInfo" > ç¡®å®š</button>-->
        <!--        {{# } }}-->
        <!--        <button class="layui-btn layui-btn-sm" lay-event="getCheckData">è·å–é€‰ä¸­è¡Œæ•°æ®</button>-->
        <!--        <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">è·å–é€‰ä¸­æ•°ç›®</button>-->
        <!--        <button class="layui-btn layui-btn-sm" lay-event="isAll">éªŒè¯æ˜¯å¦å…¨é€‰</button>-->

    </div>
</script>
<script>

    // layui.use('table', function() {
    //     var table = layui.table;
    //     var laypage = layui.laypage;
    //
    //     //æ‰§è¡Œä¸€ä¸ªlaypageå®ä¾‹
    //     laypage.render({
    //         elem: 'demo' //æ³¨æ„ï¼Œè¿™é‡Œçš„ test1 æ˜¯ IDï¼Œä¸ç”¨åŠ  # å·
    //         ,count: 50 //æ•°æ®æ€»æ•°ï¼Œä»æœåŠ¡ç«¯å¾—åˆ°
    //     });
    //
    //     //æ‰§è¡Œæ¸²æŸ“
    //     table.render({
    //         elem: '#demo' //æŒ‡å®šåŸå§‹è¡¨æ ¼å…ƒç´ é€‰æ‹©å™¨ï¼ˆæ¨èidé€‰æ‹©å™¨ï¼‰
    //         , url: 'http://127.0.0.1:8888/user/getalluser?token='+localStorage.getItem("token")
    //         , height: 600 //å®¹å™¨é«˜åº¦
    //         , cols: [[ //è¡¨å¤´
    //              {field: 'username', title: 'ç”¨æˆ·å', width: 80}
    //             ,{field: 'gender', title: 'æ€§åˆ«', width: 80}
    //             ,{field: 'password', title: 'å¯†ç ', width: 80}
    //             ,{field: 'address', title: 'åœ°å€', width: 80}
    //             ,{field: 'email', title: 'é‚®ç®±', width: 80}
    //             ,{field: 'phone', title: 'ç”µè¯', width: 80}
    //         ]]
    //     });
    // });


    $(function () {
        initData();
    });

    //è¯·æ±‚æ•°æ®
    function getData(page, limit) {
        var resultData;
        // let sensorPid=$("#select_address").val();
        var params = {"pageIndex": page, "pageSize": limit}
        resultData = dataServer.getUserList(params);
        return resultData;
    }

    function initData() {
        var initData = getData(1, 10);
        var total = initData.total;
        var dataList = initData.data;
        layui.use('table', function () {
            var laypage = layui.laypage;
            //æ‰§è¡Œä¸€ä¸ªlaypageå®ä¾‹
            laypage.render({
                elem: 'test1' //æ³¨æ„ï¼Œè¿™é‡Œçš„ test1 æ˜¯ IDï¼Œä¸ç”¨åŠ  # å·
                , count: total //æ•°æ®æ€»æ•°ï¼Œä»æœåŠ¡ç«¯å¾—åˆ°
                //,limit:10
                , limits: [10, 20, 30]
                , curr: 1
                , group: 5
                , layout: ['prev', 'page', 'next', 'limit', 'refresh', 'skip', 'count']
                , jump: function (obj, first) {
                    //objåŒ…å«äº†å½“å‰åˆ†é¡µçš„æ‰€æœ‰å‚æ•°ï¼Œæ¯”å¦‚ï¼š
                    console.log(obj.curr); //å¾—åˆ°å½“å‰é¡µï¼Œä»¥ä¾¿å‘æœåŠ¡ç«¯è¯·æ±‚å¯¹åº”é¡µçš„æ•°æ®ã€‚
                    console.log(obj.limit); //å¾—åˆ°æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°
                    //é¦–æ¬¡ä¸æ‰§è¡Œ
                    if (!first) {
                        refData(getData(obj.curr, obj.limit).data);
                    } else {
                        refData(dataList);
                    }

                }
            });
        });
    }


    function refData(dataList) {
        //var dataList=dataArraygetData(page,limit).data;
        layui.use('table', function () {
            var table = layui.table;
            //ç¬¬ä¸€ä¸ªå®ä¾‹
            table.render({
                elem: '#demo'
                , toolbar: '#toolbarMenu'
                , height: 450
                , data: dataList
                , limit: dataList.length
                //page:false
                , cols: [[ //è¡¨å¤´
                    {field: 'Id', title: 'ç¼–å·', width: 80, sort: true, fixed: 'left'}
                     , {field: 'headerIcon', title: 'å¤´åƒ',width: 80,templet:'<div><img onclick="showBgPic(this)" src="{{d.headerIcon}}" ></div>'} //,templet:'<div><img onclick="showBgPic(this)" src="{{d.url}}" ></div>'
                    , {field: 'username', title: 'ç”¨æˆ·å', width: 80,edit: 'text'}
                    , {field: 'gender', title: 'æ€§åˆ«', width: 100, edit: 'text'}
                    , {field: 'password', title: 'å¯†ç ', width: 80, edit: 'text'}
                    , {field: 'address', title: 'åœ°å€', width: 80, edit: 'text'}
                    , {field: 'email', title: 'é‚®ç®±', width: 80, edit: 'text'}
                    , {field: 'phone', title: 'ç”µè¯', width: 80, edit: 'text'}
                    , {field: '', title: 'ç¼–è¾‘', width: 250, sort: true, toolbar: '#toolbarDemo'}
                ]],
                loading: true,
                done: function (res, curr, count) {
                    $("[data-field='status']").children().each(function () {
                        if ($(this).text() == 0) {
                            $(this).text("å‘Šè­¦ä¸­")
                        } else if ($(this).text() == 1) {
                            $(this).text("ç»“æŸ")
                        } else if ($(this).text() == 2) {
                            $(this).text("å·²å¤„ç†")
                        }
                    });
                    $("[data-field='gender']").children().each(function () {
                        if($(this).text()!='æ€§åˆ«') {
                            if ($(this).text() == 2) {
                                $(this).text("ğŸ‘©");
                            } else if ($(this).text() == 1) {
                                $(this).text("ğŸ‘¨");
                            } else {
                                $(this).text("æœªçŸ¥");
                            }
                        }
                    });
                },
                parseData: function (res) {
                    return {
                        "code": res.code, //è§£ææ¥å£çŠ¶æ€
                        "msg": res.msg, //è§£ææç¤ºæ–‡æœ¬
                        "data": res.data //è§£ææ•°æ®åˆ—è¡¨
                    }
                }
            });

            //ç›‘å¬å•å…ƒæ ¼ç¼–è¾‘
            table.on('edit(test_table)',
                function (obj) {
                    var value = obj.value //å¾—åˆ°ä¿®æ”¹åçš„å€¼
                        ,
                        data = obj.data //å¾—åˆ°æ‰€åœ¨è¡Œæ‰€æœ‰é”®å€¼
                        ,
                        field = obj.field; //å¾—åˆ°å­—æ®µ
                    layer.msg('[ID: ' + data.Id + '] ' + field + ' å­—æ®µæ›´æ”¹ä¸ºï¼š' + value);
                    console.log(data.Id);
                    var jsonResult = dataServer.updateUserInfo(obj.data);
                    if (jsonResult == 1) {
                        layer.msg("æ›´æ–°æˆåŠŸï¼");
                    } else {
                        layer.msg("æ›´æ–°å¤±è´¥ï¼");
                    }
                });

            //ç›‘å¬è¡Œå•å‡»äº‹ä»¶ï¼ˆåŒå‡»äº‹ä»¶ä¸ºï¼šrowDoubleï¼‰
            // table.on('row(test_table)', function(obj){
            //     var data = obj.data;
            //     layer.alert(JSON.stringify(data), {
            //         title: 'å½“å‰è¡Œæ•°æ®ï¼š'
            //     });
            //
            //     //æ ‡æ³¨é€‰ä¸­æ ·å¼
            //     obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
            // });

            //åˆ—é‡Œçš„å·¥å…·æ 
            table.on('tool(test_table)',
                function (obj) {
                    //var checkStatus = table.checkStatus(obj.config.pid);
                    switch (obj.event) {
                        case 'delete':
                            layer.msg('data:' + obj.data);
                            del(obj);
                            break;
                        case 'update':
                            layer.msg('data:' + obj.data.Id);
                            xadmin.open('æŠ¥è­¦å¤„ç½®', './userlist-add.html' + "?id=" + obj.data.Id, 600, 400);
                            break;
                        //updateWarningInfo(obj);
                        //break;
                    }
                    ;
                });
        });
    }

    //åˆ é™¤
    function del(obj) {
        //var params={"pids":[obj.data.pid]}
        var params = obj.data;
        var resultData = dataServer.deleteUserInfo(params);
        if (resultData == 1) {
            location.reload();
        }
    }
    function showBgPic(img) {
        let content = '<img src="' + img.src + '" />';
        if (".mp4" == img.src.substr(img.src.length - 4)) {
            content = '<video width="580px" height="380px" src="' + img.src + '" controls="controls">\n' +
                'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ã€‚\n' +
                '</video>';
        }
        layer.open({
            type: 1,
            closeBtn: 1,
            shift: 2,
            area: ['800px', '400px'],
            shadeClose: true,
            content: content
        });
    }
</script>
</body>

</html>